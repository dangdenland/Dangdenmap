<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>赤樹村內部軌道圖 (赤樹輕軌)</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <style>
        body { margin: 0; padding: 0; font-family: "Microsoft JhengHei", "Heiti TC", sans-serif; background-color: #f0fdf4; /* 淺綠色背景代表村莊 */ }
        #map { height: 100vh; width: 100vw; }
        
        /* --- 返回按鈕樣式 --- */
        .back-btn {
            position: absolute;
            top: 20px;
            left: 20px;
            z-index: 1000; /* 確保在最上層 */
            background-color: #333;
            color: white;
            padding: 10px 20px;
            text-decoration: none;
            border-radius: 5px;
            font-weight: bold;
            box-shadow: 0 2px 5px rgba(0,0,0,0.3);
            transition: background 0.3s;
            display: flex;
            align-items: center;
        }
        .back-btn:hover { background-color: #555; }
        
        /* --- 站點標籤樣式 --- */
        .station-label {
            background: rgba(255, 255, 255, 0.9);
            border: 1px solid #2e7d32;
            color: #1b5e20;
            padding: 2px 6px;
            border-radius: 4px;
            font-size: 13px;
            font-weight: bold;
            white-space: nowrap;
            box-shadow: 1px 1px 3px rgba(0,0,0,0.2);
        }
    </style>
</head>
<body>

<!-- 返回按鈕：點擊後會回到上一層目錄的 index.html -->
<a href="../index.html" class="back-btn">⬅ 返回大地圖</a>

<div id="map"></div>

<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
<script>
    // ==========================================
    // 1. 站點與路線資料 (未來修改這裡即可)
    // ==========================================
    
    // 定義站點：x, y 是自訂的相對座標
    const stations = [
        { id: "st1", name: "赤樹站 (轉運站)", x: 0, y: 0, desc: "可轉乘大成線鐵路" },
        { id: "st2", name: "村役所", x: 150, y: 120, desc: "赤樹村行政中心" },
        { id: "st3", name: "圖書館", x: 280, y: 250, desc: "赤樹立圖書館" },
        { id: "st4", name: "山頂", x: 100, y: 450, desc: "赤樹山觀景台" }
    ];

    // 定義路線連接順序 (填入 id)
    const routeOrder = ["st1", "st2", "st3", "st4"];

    // ==========================================
    // 2. 地圖程式邏輯
    // ==========================================

    const map = L.map('map', {
        crs: L.CRS.Simple, // 使用平面座標
        minZoom: -2,
        maxZoom: 2,
        zoomSnap: 0.5,
        attributionControl: false
    });

    // 計算邊界以自動縮放
    let minX = Infinity, maxX = -Infinity, minY = Infinity, maxY = -Infinity;
    const latLngs = []; // 儲存畫線用的座標點

    stations.forEach(s => {
        // 將 x, y 轉換為 Leaflet 座標 [-y, x]
        const latLng = [-s.y, s.x];
        s.latLng = latLng; // 存回去方便後續使用
        
        // 邊界計算
        if (s.x < minX) minX = s.x; if (s.x > maxX) maxX = s.x;
        if (s.y < minY) minY = s.y; if (s.y > maxY) maxY = s.y;
    });

    // 依照路線順序抓出座標來畫線
    const routeLatLngs = routeOrder.map(id => {
        const station = stations.find(s => s.id === id);
        return station.latLng;
    });

    // (A) 繪製軌道線 (輕軌風格：綠色粗線)
    L.polyline(routeLatLngs, {
        color: '#4caf50', // 輕軌綠
        weight: 6,
        opacity: 0.8,
        lineJoin: 'round'
    }).addTo(map);
    
    // 軌道中心裝飾線 (白色細線，讓它看起來像軌道)
    L.polyline(routeLatLngs, {
        color: '#fff', 
        weight: 2,
        dashArray: '10, 10',
        opacity: 0.8
    }).addTo(map);

    // (B) 繪製站點
    stations.forEach(s => {
        // 圓點
        L.circleMarker(s.latLng, {
            radius: 8,
            fillColor: "#fff",
            color: "#2e7d32", // 深綠邊框
            weight: 3,
            fillOpacity: 1
        }).addTo(map).bindPopup(`<b>${s.name}</b><br>${s.desc}`);

        // 文字標籤
        L.marker(s.latLng, {
            icon: L.divIcon({
                className: 'station-label-wrapper',
                html: `<div class="station-label">${s.name}</div>`,
                iconSize: [0, 0],
                iconAnchor: [20, -10] // 稍微偏右上方顯示
            })
        }).addTo(map);
    });

    // 自動縮放視野 (留一點邊距 padding)
    const padding = 100;
    const bounds = [
        [-(minY - padding), minX - padding],
        [-(maxY + padding), maxX + padding]
    ];
    map.fitBounds(bounds);

</script>
</body>
</html>
